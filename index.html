<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gacha Cost Calculator Final Dual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .sim-btn { transition: all 0.2s; }
        .sim-btn:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        <!-- Header -->
        <div class="bg-slate-900 text-white p-6 text-center relative overflow-hidden">
            <div class="relative z-10">
                <h1 class="text-3xl font-bold">âš”ï¸ ì†Œí™˜ ë¹„ìš© & íšŸìˆ˜ ê³„ì‚°ê¸°</h1>
                <p class="text-slate-300 text-sm mt-2">ë‹¤ì´ì•„ ê°œìˆ˜ì™€ ì‹¤ì œ ë½‘ê¸° íšŸìˆ˜ë¥¼ ë™ì‹œì— í™•ì¸í•˜ì„¸ìš”</p>
            </div>
        </div>

        <div class="p-6">
            <!-- Info Bar -->
            <div class="flex flex-col md:flex-row justify-center gap-4 mb-8 text-sm">
                <div class="flex items-center justify-center gap-2 bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-100 text-indigo-900">
                    <span class="w-2 h-2 rounded-full bg-indigo-600"></span>
                    <span class="font-bold">ìºë¦­í„°:</span>
                    <span>10íšŒ 2,000 ğŸ’</span>
                </div>
                <div class="flex items-center justify-center gap-2 bg-emerald-50 px-4 py-2 rounded-lg border border-emerald-100 text-emerald-900">
                    <span class="w-2 h-2 rounded-full bg-emerald-600"></span>
                    <span class="font-bold">í«:</span>
                    <span>10íšŒ 1,000 ğŸ’</span>
                </div>
            </div>

            <!-- Selection Grid -->
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 ml-1">ëª©í‘œ ë‹¬ì„± ì¡°ê±´ ì„ íƒ</h3>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8">
                <!-- Buttons -->
                <button onclick="runSim(1, 'char', 'ëª…í•¨ (1ì¥)')" class="sim-btn group relative p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-300 hover:shadow-md text-left bg-white">
                    <div class="text-2xl mb-1">ğŸƒ</div>
                    <div class="font-bold text-slate-700 group-hover:text-indigo-600">ëª…í•¨</div>
                    <div class="text-xs text-slate-400">ìºë¦­í„° 1íšŒ</div>
                </button>

                <button onclick="runSim(2, 'char', 'ëª…í•¨ + ê³µëª…')" class="sim-btn group relative p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-300 hover:shadow-md text-left bg-white">
                    <div class="text-2xl mb-1">âš”ï¸</div>
                    <div class="font-bold text-slate-700 group-hover:text-indigo-600">ëª…í•¨+ê³µëª…</div>
                    <div class="text-xs text-slate-400">ìºë¦­í„° 2íšŒ</div>
                </button>

                <button onclick="runSim(7, 'char', '5ì´ˆì›” + ê³µëª…')" class="sim-btn group relative p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-300 hover:shadow-md text-left bg-white">
                    <div class="text-2xl mb-1">ğŸŒŸ</div>
                    <div class="font-bold text-slate-700 group-hover:text-indigo-600">5ì´ˆì›”+ê³µëª…</div>
                    <div class="text-xs text-slate-400">ìºë¦­í„° 7íšŒ</div>
                </button>

                <button onclick="runSim(9, 'char', 'ê°ì„± (í’€ëŒ)')" class="sim-btn group relative p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-300 hover:shadow-md text-left bg-white">
                    <div class="text-2xl mb-1">ğŸ‘‘</div>
                    <div class="font-bold text-slate-700 group-hover:text-indigo-600">ê°ì„±</div>
                    <div class="text-xs text-slate-400">ìºë¦­í„° 9íšŒ</div>
                </button>

                <button onclick="runSim(6, 'pet', 'í« í’€ëŒ')" class="sim-btn group relative p-4 rounded-xl border-2 border-slate-100 hover:border-emerald-300 hover:shadow-md text-left bg-white">
                    <div class="text-2xl mb-1">ğŸ¾</div>
                    <div class="font-bold text-slate-700 group-hover:text-emerald-600">í« í’€ëŒ</div>
                    <div class="text-xs text-slate-400">í« 6íšŒ (ì €ë ´)</div>
                </button>
            </div>

            <!-- Loading Spinner -->
            <div id="loading" class="hidden py-10 text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-slate-200 border-t-indigo-600"></div>
                <p class="mt-2 text-sm text-slate-500 font-medium">50,000íšŒ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...</p>
            </div>

            <!-- Result Area -->
            <div id="resultsArea" class="hidden animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-end border-b border-slate-200 pb-4 mb-6">
                    <div>
                        <h2 id="resTitle" class="text-2xl font-bold text-slate-900">ê²°ê³¼</h2>
                        <p id="resDesc" class="text-sm text-slate-500 mt-1"></p>
                    </div>
                </div>

                <!-- Three Columns -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <!-- Lucky -->
                    <div class="bg-blue-50 rounded-2xl p-5 border border-blue-100 relative overflow-hidden">
                        <h4 class="text-xs font-bold text-blue-500 uppercase tracking-wide mb-3">ìƒìœ„ 30% (ìš´ ì¢‹ìŒ)</h4>
                        <div id="val30_cost" class="text-2xl font-bold text-blue-900">-</div>
                        <div id="val30_pulls" class="text-lg font-medium text-blue-600 mt-1">-</div>
                    </div>
                    <!-- Median -->
                    <div class="bg-slate-100 rounded-2xl p-5 border border-slate-200 relative overflow-hidden ring-2 ring-indigo-500 ring-offset-2">
                        <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-3">ìƒìœ„ 50% (í‰ê· )</h4>
                        <div id="val50_cost" class="text-3xl font-bold text-indigo-900">-</div>
                        <div id="val50_pulls" class="text-xl font-medium text-indigo-600 mt-1">-</div>
                    </div>
                    <!-- Unlucky -->
                    <div class="bg-red-50 rounded-2xl p-5 border border-red-100 relative overflow-hidden">
                        <h4 class="text-xs font-bold text-red-500 uppercase tracking-wide mb-3">ìƒìœ„ 95% (í­ì‚¬ ìœ„í—˜)</h4>
                        <div id="val95_cost" class="text-2xl font-bold text-red-900">-</div>
                        <div id="val95_pulls" class="text-lg font-medium text-red-600 mt-1">-</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm h-72">
                    <canvas id="chartCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        function runSim(targetCopies, type, title) {
            // UI Update
            document.querySelectorAll('.sim-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-indigo-500', 'bg-indigo-50');
            });
            event.currentTarget.classList.add('ring-2', 'ring-indigo-500', 'bg-indigo-50');

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultsArea').classList.add('hidden');

            setTimeout(() => {
                calculate(targetCopies, type, title);
            }, 50);
        }

        function calculate(targetCopies, type, title) {
            const iterations = 50000;
            const pricePer10 = type === 'char' ? 2000 : 1000;
            const pricePer1 = pricePer10 / 10;
            
            const resultsPulls = []; // Store pulls count

            for (let i = 0; i < iterations; i++) {
                let copies = 0;
                let pity = 0;
                let pulls = 0;

                while (copies < targetCopies) {
                    pulls++;
                    pity++;
                    if (pity >= 120) {
                        copies++;
                        pity = 0;
                    } else if (Math.random() < 0.02) {
                        copies++;
                        pity = 0;
                    }
                }
                resultsPulls.push(pulls);
            }

            resultsPulls.sort((a, b) => a - b);

            const getPulls = (pct) => resultsPulls[Math.floor(iterations * pct)];
            
            const p30_pulls = getPulls(0.30);
            const p50_pulls = getPulls(0.50);
            const p95_pulls = getPulls(0.95);

            const p30_cost = p30_pulls * pricePer1;
            const p50_cost = p50_pulls * pricePer1;
            const p95_cost = p95_pulls * pricePer1;

            // DOM Update
            document.getElementById('resTitle').innerText = title;
            document.getElementById('resDesc').innerText = `${type === 'char' ? 'ìºë¦­í„°' : 'í«'} ${targetCopies}íšŒ íšë“ ëª©í‘œ`;

            // Display Cost & Pulls
            document.getElementById('val30_cost').innerText = p30_cost.toLocaleString() + " ğŸ’";
            document.getElementById('val30_pulls').innerText = p30_pulls.toLocaleString() + "íšŒ";

            document.getElementById('val50_cost').innerText = p50_cost.toLocaleString() + " ğŸ’";
            document.getElementById('val50_pulls').innerText = p50_pulls.toLocaleString() + "íšŒ";

            document.getElementById('val95_cost').innerText = p95_cost.toLocaleString() + " ğŸ’";
            document.getElementById('val95_pulls').innerText = p95_pulls.toLocaleString() + "íšŒ";

            drawChart(resultsPulls, pricePer1, type);

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('resultsArea').classList.remove('hidden');
        }

        function drawChart(pullData, pricePer1, type) {
            const ctx = document.getElementById('chartCanvas').getContext('2d');
            if (chartInstance) chartInstance.destroy();

            const min = pullData[0];
            const max = pullData[pullData.length-1];
            const binCount = 40;
            const step = Math.ceil((max - min) / binCount);
            
            const labels = [];
            const counts = [];
            let currentLimit = min + step;
            let idx = 0;

            for(let i=0; i<binCount; i++) {
                let count = 0;
                while(idx < pullData.length && pullData[idx] < currentLimit) {
                    count++;
                    idx++;
                }
                // Label shows Cost (k)
                const costVal = Math.floor(((currentLimit - step) * pricePer1) / 1000) + 'k';
                labels.push(costVal);
                counts.push(count);
                currentLimit += step;
            }

            const color = type === 'char' ? '#4f46e5' : '#10b981';
            const bg = type === 'char' ? 'rgba(79, 70, 229, 0.2)' : 'rgba(16, 185, 129, 0.2)';

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ìœ ì € ë¶„í¬',
                        data: counts,
                        borderColor: color,
                        backgroundColor: bg,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: { 
                            intersect: false,
                            mode: 'index',
                            callbacks: {
                                title: (items) => {
                                    const costLabel = items[0].label; // e.g., "10k"
                                    const numericCostK = parseFloat(costLabel.replace('k', '')); // e.g., 10
                                    const actualCost = numericCostK * 1000; // e.g., 10000

                                    // pricePer1 is accessible here due to closure
                                    const estimatedPulls = Math.round(actualCost / pricePer1);

                                    return `ë¹„ìš©: ì•½ ${costLabel} ë‹¤ì´ì•„ (ì†Œí™˜ íšŸìˆ˜: ì•½ ${estimatedPulls.toLocaleString()}íšŒ)`;
                                },
                                label: (item) => `${item.raw.toLocaleString()}ëª…` // Also improve label formatting
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { display: false }, 
                            ticks: { maxTicksLimit: 8 },
                            title: { display: true, text: 'ë¹„ìš© (ì²œ ë‹¤ì´ì•„ ë‹¨ìœ„)' }
                        },
                        y: { display: false }
                    }
                }
            });
        }
    </script>
</body>
</html>
